var art_gallery=angular.module("art_gallery",["ngMaterial","ngAnimate","ngMessages","ngAria","ui.router"]);!function(t){t.config(["$stateProvider","$urlRouterProvider","$mdIconProvider","$httpProvider",function(e,o,r,n){"undefined"!=typeof web3?t.web3Provider=web3.currentProvider:t.web3Provider=new Web3.providers.HttpProvider("http://127.0.0.1:7545"),n.interceptors.push("authInterceptor"),o.otherwise("/"),r.iconSet("action","public/images/action-icons.svg",24).iconSet("content","public/images/content-icons.svg",24),e.state("updateart",{url:"/updateArt",templateUrl:"partials/updateart-partial.html",controller:"updateartController"}).state("home",{url:"/",templateUrl:"partials/home-partial.html",controller:"HomeController"}).state("about",{url:"/about",templateUrl:"partials/about-partial.html",controller:"AboutController"}).state("login",{url:"/login",templateUrl:"partials/login-partial.html",controller:"AboutController"})}]),t.run(["$window","$rootScope","$state","storeService",function(t,e,o,r){}])}(art_gallery),function(t){t.factory("authInterceptor",function(t,e,o){return{request:function(t){return t.headers=t.headers||{},o.sessionStorage.token&&(t.headers["x-access-token"]=o.sessionStorage.token),console.log(t),t},response:function(t){return t.status,t||e.when(t)}}})}(art_gallery),function(t){t.service("storeService",["$http",function(t){var e={},o="http://localhost:3000";return e.query=function(e){t({method:"GET",url:o+"/api/stores"}).then(function(t){e(t.data,null)},function(t){e(null,t)})},e.create=function(e,r){t({method:"POST",url:o+"/api/stores",data:e}).then(function(t){r(t.data,null)},function(t){r(null,t)})},e.purchase=function(e,r,n){t({method:"PUT",url:o+"/api/stores/purchase/"+e,data:r}).then(function(t){n(t.data,null)},function(t){n(null,t)})},e.login=function(e,r){t({method:"POST",url:o+"/api/login",data:e}).then(function(t){r(t.data,null)},function(t){r(null,t)})},e}])}(art_gallery),function(t){t.controller("AboutController",["$scope",function(t){}])}(art_gallery),function(t){t.controller("HomeController",["$rootScope","$scope","storeService","$mdDialog",function(t,e,o,r){e.arts=[],t.$on("newToken",function(){o.query(function(t,o){e.arts=t,console.log(e.arts)})}),e.openConfirmPurchase=function(t,n){n.preventDefault();r.show({templateUrl:"/partials/shop-modal-partial.html",controller:"shopModalController",parent:angular.element(document.body),resolve:{art:function(){return t}}}).then(function(t){o.query(function(t,o){e.arts=t})},function(){})}}])}(art_gallery),function(t){t.controller("shopModalController",["$scope","storeService","$mdDialog","$mdToast","art",function(e,o,r,n,a){e.art=a,web3=new Web3(t.web3Provider),e.price=(web3.fromWei(a.price,"ether")/.001634).toFixed(2),console.log(e.price),e.cancel=function(){r.cancel()},e.save=function(){o.purchase(e.art.id,{price:e.art.price},function(t,e){e?n.show({template:'<md-toast class="md-toast error" >Error purchasing the art</md-toast>',hideDelay:6e3,position:"top right"}):(n.show({template:'<md-toast class="md-toast success" >Purchase succesfull</md-toast>',hideDelay:6e3,position:"top right"}),r.hide())})}}])}(art_gallery),function(t){t.controller("updateartController",["$scope","storeService","$mdToast","$timeout",function(e,o,r,n){e.art={},web3=new Web3(t.web3Provider),e.updateArt=function(){e.art.price=.001634*e.art.price,o.create(e.art,function(t,o){o?r.show({template:'<md-toast class="md-toast error" >Error saving the art</md-toast>',hideDelay:6e3,position:"top right"}):(r.show({template:'<md-toast class="md-toast success" >New art work saved succesfull</md-toast>',hideDelay:6e3,position:"top right"}),n(function(){e.art={},e.artForm.$setPristine(),e.artForm.$setUntouched(),e.artForm.$submitted=!1}))})}}]),t.directive("addressInvalid",function(){return{restrict:"A",require:"ngModel",link:function(t,e,o,r){r.$validators.addressInvalid=function(t){return web3.isAddress(t)}}}})}(art_gallery),function(t){t.directive("setToken",[function(){return{restrict:"E",templateUrl:"/partials/setToken-partial.html",controller:function(t,e,o,r){e.user={address:"0xC5fdf4076b8F3A5357c5E395ab970B5B54098Fef",key:"MBJO5YBN575YZJX5H6DV"},e.token=o.sessionStorage.token,console.log("directiva"),e.getToken=function(){r.login(e.user,function(t){t.auth&&(o.sessionStorage.token=t.token,e.token=t.token,e.$broadcast("newToken",{}))})}},link:function(t,e,o){}}}])}(art_gallery),function(t){t.directive("userAnonymousDirective",["$window",function(t){return{restrict:"A",link:function(e,o,r,n){console.log(o),t.sessionStorage.token?o.css("display","none"):o.css("display","block")}}}])}(art_gallery),function(t){t.directive("userAuthenticatedDirective",["$window",function(t){return{link:function(e,o,r,n){t.sessionStorage.token?o.css("display","block"):o.css("display","none")}}}])}(art_gallery);